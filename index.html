<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth Alarm Scheduler</title>
  <!-- Bootstrap CSS -->
  <link 
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" 
    rel="stylesheet"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" 
    crossorigin="anonymous" 
  />
  <style>
    /* Utility to hide sections */
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container mt-5">
    <!-- Connection/Login Page -->
    <div id="connectionPage">
      <h2>Bluetooth Connection</h2>
      <p>Click the button below to connect to your Bluetooth device.</p>
      <button id="connectButton" class="btn btn-primary">Connect</button>
      <p id="connectionStatus" class="mt-3 text-info"></p>
    </div>

    <!-- Scheduler Page -->
    <div id="schedulerPage" class="hidden">
      <h2>Alarm Scheduler</h2>
      <p>Set multiple alarms:</p>
      <form id="alarmForm" class="form-inline mb-4">
        <div class="form-group mb-2">
          <label for="alarmTime" class="sr-only">Alarm Time</label>
          <input type="time" id="alarmTime" class="form-control" placeholder="Time" required>
        </div>
        <div class="form-group mx-sm-3 mb-2">
          <label for="alarmLabel" class="sr-only">Label</label>
          <input type="text" id="alarmLabel" class="form-control" placeholder="Alarm Label">
        </div>
        <button type="submit" class="btn btn-success mb-2">Add Alarm</button>
      </form>
      <h3>Scheduled Alarms</h3>
      <ul id="alarmList" class="list-group"></ul>
    </div>
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script 
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js" 
    integrity="sha384-DfXdG6s3k9i4X6Ksb8N6z/4zXb3wLKKc3+rzV0lGxQ9a/Pzfo+RjI/0qYgbl5Zb6" 
    crossorigin="anonymous">
  </script>
  <script 
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js" 
    integrity="sha384-LtrjvnR4/JqsC8b+gi7LyLR02F9qV4i6t7VrO8z6e4QEE6jw6J9fWvGdT1SpI6fT" 
    crossorigin="anonymous">
  </script>

  <script>
    // Simulated Bluetooth connection using the Web Bluetooth API
    async function connectBluetooth() {
      try {
        const options = {
          // For demo purposes; in production you may want to filter by services.
          acceptAllDevices: true
        };
        const device = await navigator.bluetooth.requestDevice(options);
        document.getElementById('connectionStatus').textContent = 'Connected to ' + (device.name || 'Unknown Device');
        // Switch to scheduler page after connection
        document.getElementById('connectionPage').classList.add('hidden');
        document.getElementById('schedulerPage').classList.remove('hidden');
      } catch (error) {
        document.getElementById('connectionStatus').textContent = 'Connection failed: ' + error;
      }
    }

    // Bind connection button click event
    document.getElementById('connectButton').addEventListener('click', connectBluetooth);

    // Alarm Scheduler Logic
    const alarms = [];

    document.getElementById('alarmForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const alarmTimeInput = document.getElementById('alarmTime').value;
      const alarmLabelInput = document.getElementById('alarmLabel').value || "Alarm";
      
      if (!alarmTimeInput) {
        alert('Please select a time for the alarm.');
        return;
      }
      
      const now = new Date();
      let alarmTime = new Date();
      const [hours, minutes] = alarmTimeInput.split(':');
      alarmTime.setHours(hours, minutes, 0, 0);
      
      // If the alarm time has already passed today, schedule for the next day
      if (alarmTime <= now) {
        alarmTime.setDate(alarmTime.getDate() + 1);
      }
      
      const timeout = alarmTime - now;
      
      // Schedule the alarm with setTimeout
      const alarmId = setTimeout(function() {
        alert('Alarm: ' + alarmLabelInput + ' is ringing!');
      }, timeout);
      
      // Save the alarm details
      const alarmEntry = {
        time: alarmTime.toLocaleTimeString(),
        label: alarmLabelInput,
        id: alarmId
      };
      
      alarms.push(alarmEntry);
      updateAlarmList();
      
      // Clear input fields for new alarm entry
      document.getElementById('alarmTime').value = '';
      document.getElementById('alarmLabel').value = '';
    });

    // Update the displayed list of scheduled alarms
    function updateAlarmList() {
      const alarmList = document.getElementById('alarmList');
      alarmList.innerHTML = '';
      alarms.forEach((alarm, index) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.textContent = alarm.label + ' at ' + alarm.time;
        
        const deleteButton = document.createElement('button');
        deleteButton.className = 'btn btn-danger btn-sm';
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = function() {
          clearTimeout(alarm.id);
          alarms.splice(index, 1);
          updateAlarmList();
        };
        
        li.appendChild(deleteButton);
        alarmList.appendChild(li);
      });
    }
  </script>
</body>
</html>
